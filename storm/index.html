<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storm</title>
    <link rel="icon" href="visuals/favicon.png" type="image/png">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZG39HWNCCF"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZG39HWNCCF');
    </script>

    
    <script src="js/upload-modal.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code:wght@500&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="css/prism-theme.css">
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Libraries -->
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <!-- Login Overlay -->
    <div id="login-overlay">
        <form id="login-form" class="glass">
            <h2>Indtast adgangskode</h2>
            <input type="text" id="password-input" placeholder="Adgangskode" autocomplete="off">
            <span id="login-error"></span>
            <button type="submit">Log ind</button>
        </form>
    </div>

    <!-- Brain Memory Modal -->
    <div id="brain-modal-overlay">
        <div id="brain-modal">
            <h3>
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                Save to Memory
            </h3>
            <div id="brain-modal-status">Processing...</div>
            <textarea id="brain-refined-text" placeholder="Refined memory will appear here..."></textarea>
            <div id="brain-modal-buttons">
                <button type="button" class="brain-btn cancel" id="brain-cancel-btn">Cancel</button>
                <button type="button" class="brain-btn deny" id="brain-deny-btn">Deny</button>
                <button type="button" class="brain-btn accept" id="brain-accept-btn">Accept</button>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal-overlay" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 2000; align-items: center; justify-content: center;">
        <div id="upload-modal" style="background: white; border-radius: 1rem; padding: 2rem; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin-bottom: 1.5rem; color: #1f2937; font-size: 1.5rem; font-weight: 700;">Choose Upload Type</h3>
            
            <!-- Upload Type Selector -->
            <div id="upload-type-selector" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                <button type="button" class="upload-type-btn" data-type="file" style="padding: 2rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; background: white; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <svg style="width: 3rem; height: 3rem; color: #6b7280;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <span style="font-weight: 600; color: #1f2937; font-size: 1rem;">Local File</span>
                    <span style="font-size: 0.85rem; color: #6b7280;">PDF, TXT, Code</span>
                </button>
                
                <button type="button" class="upload-type-btn" data-type="github" style="padding: 2rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; background: white; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <svg style="width: 3rem; height: 3rem; color: #6b7280;" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    <span style="font-weight: 600; color: #1f2937; font-size: 1rem;">GitHub Repo</span>
                    <span style="font-size: 0.85rem; color: #6b7280;">Attach indexed repo</span>
                </button>
            </div>
            
            <!-- File Upload Section -->
            <div id="file-upload-section" style="display: none;">
                <h4 style="margin-bottom: 1rem; color: #1f2937; font-size: 1.1rem; font-weight: 600;">Upload Local Files</h4>
                <div id="drop-zone" style="border: 2px dashed #d1d5db; border-radius: 0.75rem; padding: 3rem 2rem; text-align: center; background: #f9fafb; cursor: pointer; transition: all 0.2s;">
                    <svg style="width: 3rem; height: 3rem; margin: 0 auto 1rem; color: #9ca3af;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p style="color: #6b7280; font-weight: 500; margin: 0;">Drag & drop files here</p>
                    <p style="color: #9ca3af; font-size: 0.85rem; margin: 0.5rem 0 0 0;">or click to browse</p>
                    <p style="color: #9ca3af; font-size: 0.75rem; margin: 1rem 0 0 0;">Supports: PDF, TXT, MD, PY, JS, HTML, CSS, JSON</p>
                </div>
                <input type="file" id="modal-file-input" multiple accept=".pdf,.txt,.md,.py,.js,.html,.css,.json" style="display: none;">
                <div id="file-list" style="margin-top: 1rem;"></div>
            </div>
            
            <!-- GitHub Repo Selection -->
            <div id="github-repo-section" style="display: none;">
                <h4 style="margin-bottom: 0.5rem; color: #1f2937; font-size: 1.1rem; font-weight: 600;">Select GitHub Repository</h4>
                <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1rem; line-height: 1.5;">This repo will be attached to your current chat session. I'll have full access to the code to answer your questions.</p>
                <div id="github-repos-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.5rem;">
                    <p style="color: #9ca3af; padding: 1rem; text-align: center;">Loading repositories...</p>
                </div>
            </div>
            
            <!-- Actions -->
            <div style="display: flex; gap: 0.5rem; margin-top: 2rem;">
                <button type="button" id="close-upload-modal" style="flex: 1; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; background: white; cursor: pointer; font-weight: 500; font-family: inherit; font-size: 1rem; color: #6b7280; transition: all 0.2s;">Cancel</button>
                <button type="button" id="confirm-upload" style="flex: 1; padding: 0.75rem; border-radius: 0.5rem; border: none; background: #4f46e5; color: white; cursor: pointer; font-weight: 500; font-family: inherit; font-size: 1rem; display: none; transition: all 0.2s;">Attach</button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app-container" style="display: none;">
        <aside id="history-panel" class="glass hidden">
            <h3>Chat Historik</h3>
            
            <!-- Navigation Links -->
            <div id="nav-links" style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.3);">
                <a href="github.html" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; color: rgba(255, 255, 255, 0.9); text-decoration: none; font-size: 0.9rem; transition: all 0.2s ease; cursor: pointer;">
                    <span style="font-size: 1rem;">üêô</span>
                    <span>GitHub</span>
                </a>
                <a href="rag.html" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; color: rgba(255, 255, 255, 0.9); text-decoration: none; font-size: 0.9rem; transition: all 0.2s ease; cursor: pointer;">
                    <span style="font-size: 1rem;">üìö</span>
                    <span>Knowledge Base</span>
                </a>
            </div>
            
            <ul id="chat-history-list"></ul>
        </aside>
        
        <div id="sidebar-overlay"></div>

        <main id="chat-container" class="glass">
            <header id="chat-header">
                <button id="history-toggle" title="Toggle Chat History">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                </button>
                <span id="chat-topic">Ask Storm</span>
                <div style="display: flex; gap: 0.5rem;">
                    <select id="model-select" title="AI Model">
                        <option value="moderate" selected>‚öñÔ∏è Haiku</option>
                        <option value="simple">‚ö° Gemini Pro</option>
                        <option value="complex">üß† Sonnet</option>
                    </select>
                </div>
            </header>
            
            <div id="message-list"></div>

            <form id="input-area-form">
                <div id="action-buttons-row">
                    <button type="submit" class="icon-button" title="Send Message">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                        </svg>
                    </button>
                    <button type="button" id="upload-btn-mobile" class="icon-button" title="Upload File">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                        </svg>
                    </button>
                    <button type="button" id="mic-btn-mobile" class="icon-button" title="Start/Stop Listening">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15a3 3 0 01-3-3V4.5a3 3 0 016 0v7.5a3 3 0 01-3 3z" />
                        </svg>
                    </button>
                </div>

                <div id="input-row">
                    <div class="input-bar-glass glass">
                        <input id="message-input" placeholder="Ask anything..." autocomplete="off">
                    </div>
                    <button type="submit" class="icon-button" title="Send Message">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                        </svg>
                    </button>
                    <button type="button" id="upload-btn" class="icon-button" title="Upload File">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                        </svg>
                    </button>
                    <input type="file" id="file-input" multiple>
                    <button type="button" id="mic-btn" class="icon-button" title="Start/Stop Listening">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15a3 3 0 01-3-3V4.5a3 3 0 016 0v7.5a3 3 0 01-3 3z" />
                        </svg>
                    </button>
                </div>
            </form>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/state.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/socket.js"></script>
    <script src="js/features.js"></script>
    <script src="js/upload-modal.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
